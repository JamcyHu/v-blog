# Mysql
#### 定义
开放源代码的关系型数据库管理系统
#### MySQL存储引擎区别
|  表头   | InnoDB  | MYISAM  |
|  ----  | ----  |----  |
| 外键    | 支持| |
| 锁  | 表锁和行锁 |表锁|
| 可恢复性  | 由事务日志恢复 |无日志 |
| 索引与表结构  | 聚簇，数据与索引集中存储，.ibd和.frm | 数据.MYD，索引.MYI|
| 查询性能  |  |一般快 |
#### 三大范式：
- 第一：每列保持原子性，字段不可分解
- 第二：表中每列都和主键相关
- 第三：表中每列都和主键列直接相关

#### 数据类型
- 整数
- 浮点数

DECIMAL为浮点数，使用字符串存储，能精确到小数
- 日期

常用的有year、time、date、datatime(1000年-9999年，秒，8位，时区无关)、timestamp（1970-2038年，秒，4位，时区相关）
应用场景：尽量使用timestamp,更高的空间效率
## 索引
#### 定义：
对数据库表的一列或多列的值进行排序的一种结构
#### 索引优缺点
优点：
- 加快数据的检索速度
- 将随机I/O变成顺序I/O（B+树的叶子节点连接在一起）
- 加速表与表之间的连接

缺点：
- 索引占用物理空间(空间)
- 创建和维护索引都需要时间(时间)
#### 索引的数据结构
索引的数据结构主要是B+树和哈希表，对应的索引分别为B+树索引(InnoDB引擎的默认索引类型)和哈希索引（InnoDB）
B+树：所有的记录节点都是按照键值的大小顺序放在叶子节点上（有序性，效率高，支持排序和范围查询）.

哈希：对每行数据的索引列哈希计算，哈希值为key，指向数据行的指针作为哈希表value,适合精确查找O(1)
#### B+,hash索引区别
- 哈希一般用精确的等值查找，B+树除了精确的等值查找外还有其他查找（大多数情况选用）
- 哈希不支持排序，哈希表无序
- 哈希不支持范围查找
- 哈希不支持模糊查询及多列索引的最左前缀匹配
- 哈希有冲突不稳定，B+树稳定（每次都从根节点到叶子节点）
#### 索引种类（一个索引可有多个种类）
- 主键索引：数据列不能重复和NULL，一个表只能有一个主键索引
- 组合索引：多个列值组成的索引
- 唯一索引：数据列不能重复，可以NULL，索引值唯一
- 全文索引：对文本内容搜索
- 普通索引：基本的索引类型，可为NULL
#### B树和B+树区别
- B+树叶子节点相连，方便顺序检索
- B树内部节点和叶子节点都放键值，B+树内部节点只有键没值，叶子节点放键和值
#### 不选B树的原因
- B+树空间利用率更高，B+树内部节点只存储键，树高度变低，减少I/O次数，检索更快
- B+叶子节点连接在一起，范围查找，顺序查找方便
- B+树更稳定，查询从根节点到叶子节点，B树适合随机检索，B+树适合随机检索和顺序检索
#### 聚簇索引，非聚簇索引
- 聚簇索引：数据和结构一起存储，索引结构的叶子节点保留数据行
- 非聚簇索引：数据和索引分开存储，索引叶子检点存储的是指向数据行的地址

InnoDB：主聚辅非聚
MyISAM：主非聚辅非聚
#### 非聚簇索引不一定回表，涉及索引覆盖
- 当select 主键,xx where xx=,走辅助索引能查数据，这就是索引覆盖
- select 主键，xx,xx1 where xx=，需要建立xx和xx1的联合索引
#### 索引设计原则
- 适合索引列在where后出行的列或连接句子中指定的列，而不是select后的列
- 索引列基数大效果好，即区分度高的列
- 尽量用短索引(磁盘I/O少，缓存能存更多键值)
- 尽量使用最左前缀
- 不要过度索引，创建维护需要时间空间
#### 索引的使用场景
#### 索引优化
将不符合要求的索引优化成符合索引设计原则和应用场景的索引
- 索引的设计原则
- 索引不能是表达式一部分和函数的参数，如where a+1=2
- 将区分度高的索引放在前面
- 少使用select *
#### 创建/删除索引


